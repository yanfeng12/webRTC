<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>web调取摄像头</title>

    
            <script type="text/javascript">
            var scene = null;
            var camera = null;
            var renderer = null;
            
            var mesh = null;
            var id = null;
            
            function init() {
                renderer = new THREE.WebGLRenderer({//渲染器
                    canvas: document.getElementById('mainCanvas')//画布
                });
                renderer.setClearColor(0x000000);//画布颜色
                scene = new THREE.Scene();//创建场景
                
                camera = new THREE.OrthographicCamera(-5, 5, 3.75, -3.75, 0.1, 100);//正交投影照相机
                camera.position.set(15, 25, 25);//相机位置
                camera.lookAt(new THREE.Vector3(0, 2, 0));//lookAt()设置相机所看的位置
                scene.add(camera);//把相机添加到场景中
                
               
                
var onProgress = function ( xhr ) {  
        if ( xhr.lengthComputable ) {  
            var percentComplete = xhr.loaded / xhr.total * 100;  
                    }  
                };  
  
var onError = function ( xhr ) { };  

            }
        </script>
    
</head>
<body onload="init()">
    <div style='position:relative'>
        
        <div style='position:absolute; z-index:2;  '>
        <video src=""></video>
        </div>
        
<script>
    if (navigator.mediaDevices === undefined) {
        navigator.mediaDevices = {};
    }
    if (navigator.mediaDevices.getUserMedia === undefined) {
        navigator.mediaDevices.getUserMedia = function(constraints) {
            var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
            if (!getUserMedia) {
                return Promise.reject(new Error('getUserMedia is not implemented in this browser'));
            }
            return new Promise(function(resolve, reject) {
                getUserMedia.call(navigator, constraints, resolve, reject);
            });
        }
    }
window.URL = (window.URL || window.webkitURL || window.mozURL || window.msURL);
        var mediaOpts = {
            audio: false,
            // Prefer camera resolution nearest to 1280x720.
            video: { width: 1280, height: 720 },
        }
            function successFunc(stream) {
                var video = document.querySelector('video');
                if ("srcObject" in video) {
                    video.srcObject = stream
                } else {
                    video.src = window.URL && window.URL.createObjectURL(stream) || stream
                }
                video.play();
            }
            function errorFunc(err) {
                alert(err.name);
            }

            navigator.getUserMedia(mediaOpts, successFunc, errorFunc);
    
    
//     setInterval(function () {
//                if(!flag){
//                        return;
//                }
//            context.drawImage(video, 0, 0, canvas.width = video.videoWidth, canvas.height = video.videoHeight);
//                    var image = canvas.toDataURL("image/png").replace("data:image/png;base64,", ""); 
//            $.ajax({
//                                url : 'qRCodeAction_decoderQRCode.action',
//                                async : false,
//                                type : 'post',
//                                data : {
//                                        'time' : (new Date()).toString(),
//                                        'img' : image
//                                },
//                                success : function(result) {
//                                           
//                                },
//                    });
//        }, 5000);
    
    
//            setInterval(function () {  
//            context.drawImage(video, 0, 0, canvas.width = video.videoWidth, canvas.height = video.videoHeight);  
//            $.post('/Home/QRcodeDecode', { "img": canvas.toDataURL().substr(22) }, function (data, status) {  
//                if (status == "success" && data != "no")location.href = "/Home/Result/" + data;                 
//            }, "text");  
//        }, 500);  
    
    </script>

    <div style='position:absolute; z-index:3;filter:alpha(Opacity=80);-moz-opacity:0.8;opacity: 0.8;'>
    <canvas id="mainCanvas" width="1280px" height="720px" ></canvas>
        </div>
</div>
</body>
</html>